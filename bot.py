from telegram import Bot
from datetime import datetime
import random
import json
import schedule
import time
import asyncio
import os

# –¢–æ–∫–µ–Ω –≤–∞—à–æ–≥–æ –±–æ—Ç–∞

CHAT_ID = '-4690038303'

BOT_TOKEN = os.getenv("BOT_TOKEN")

# –®–ª—è—Ö –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
DATABASE_PATH = 'birthdays.json'

# –°–ø–∏—Å–æ–∫ –ø—Ä–∏–≤—ñ—Ç–∞–Ω—å
greetings = [
    "üéâ –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ù–µ—Ö–∞–π –ë–æ–≥ –∑–∞–≤–∂–¥–∏ –±—É–¥–µ –ø–æ—Ä—É—á —ñ –Ω–∞–ø—Ä–∞–≤–ª—è—î —Ç–≤–æ—ó –∫—Ä–æ–∫–∏!",
    "üåü {name}, –≤—ñ—Ç–∞—é –∑—ñ —Å–≤—è—Ç–æ–º! –ë–∞–∂–∞—é —Ç–æ–±—ñ –ë–æ–∂–æ–≥–æ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω—è, —Ä–∞–¥–æ—Å—Ç—ñ —Ç–∞ –º–∏—Ä—É –≤ —Å–µ—Ä—Ü—ñ.",
    "üéÇ –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ù–µ—Ö–∞–π —É —Ç–≤–æ—î–º—É –∂–∏—Ç—Ç—ñ –±—É–¥–µ –±—ñ–ª—å—à–µ —Å–≤—ñ—Ç–ª–∞, –¥–æ–±—Ä–∞ —ñ —Ç–µ–ø–ª–∞!",
    "üéà {name}, –≤—ñ—Ç–∞—é –∑ –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è! –ù–µ—Ö–∞–π –ì–æ—Å–ø–æ–¥—å –¥–∞—Ä—É—î —Ç–æ–±—ñ —Å–∏–ª–∏ –π –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è –¥–ª—è –≤—Å—ñ—Ö –∑–≤–µ—Ä—à–µ–Ω—å.",
    "‚ú® –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ú–æ–ª—é—Å—è, —â–æ–± —É —Ç–≤–æ—î–º—É –∂–∏—Ç—Ç—ñ –∑–∞–≤–∂–¥–∏ –±—É–ª–æ –º—ñ—Å—Ü–µ –¥–ª—è —â–∞—Å—Ç—è —Ç–∞ –≤—ñ—Ä–∏.",
    "üéÅ {name}, –∑—ñ —Å–≤—è—Ç–æ–º! –ù–µ—Ö–∞–π –ë–æ–∂–∞ –ª—é–±–æ–≤ –±—É–¥–µ —Ç–≤–æ—ó–º –∫–æ–º–ø–∞—Å–æ–º —É –∂–∏—Ç—Ç—ñ, –∞ —Å–µ—Ä—Ü–µ —Å–ø–æ–≤–Ω–∏—Ç—å—Å—è –≤–¥—è—á–Ω—ñ—Å—Ç—é.",
    "ü•≥ –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ë–∞–∂–∞—é –≥–∞—Ä–º–æ–Ω—ñ—ó, —Ç–µ–ø–ª–∏—Ö —Å—Ç–æ—Å—É–Ω–∫—ñ–≤ —ñ –ë–æ–∂–æ–≥–æ –∑–∞—Ö–∏—Å—Ç—É –≤ —É—Å—å–æ–º—É!",
    "üåü {name}, –≤—ñ—Ç–∞—î–º–æ –∑ –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è! –ù–µ—Ö–∞–π —É—Å—ñ —Ç–≤–æ—ó –º—Ä—ñ—ó –∑–¥—ñ–π—Å–Ω—é—é—Ç—å—Å—è, –∞ –∂–∏—Ç—Ç—è –±—É–¥–µ –Ω–∞–ø–æ–≤–Ω–µ–Ω–µ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω—è–º–∏!",
    "üéâ –ó—ñ —Å–≤—è—Ç–æ–º, {name}! –ë–∞–∂–∞—é —Ç–æ–±—ñ —Å–≤—ñ—Ç–ª–∏—Ö –¥–Ω—ñ–≤, –¥–æ–±—Ä–∏—Ö –¥—Ä—É–∑—ñ–≤ —ñ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è, —â–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∑–≥–æ—Ä–∏.",
    "üéÇ {name}, –∑ –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è! –†–∞–¥–æ—Å—Ç—ñ, –º–∏—Ä—É –π –¥–æ—Å—Ç–∞—Ç–∫—É —Ç–æ–±—ñ, –∞ —â–µ –±–∞–≥–∞—Ç–æ —Ç–µ–ø–ª–∏—Ö –º–æ–º–µ–Ω—Ç—ñ–≤ –∑ –±–ª–∏–∑—å–∫–∏–º–∏.",
    "‚ú® –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ù–µ—Ö–∞–π —Ç–≤–æ—î —Å–µ—Ä—Ü–µ –∑–∞–≤–∂–¥–∏ —Ä–∞–¥—ñ—î, –∞ –¥–æ—Ä–æ–≥–∞ –≤–µ–¥–µ –¥–æ –¥–æ–±—Ä–∞.",
    "üéÅ {name}, –≤—ñ—Ç–∞—é —Ç–µ–±–µ –∑—ñ —Å–≤—è—Ç–æ–º! –ù–µ—Ö–∞–π —Ç–≤–æ—î –∂–∏—Ç—Ç—è –±—É–¥–µ —è—Å–∫—Ä–∞–≤–∏–º –ø—Ä–∏–∫–ª–∞–¥–æ–º –¥–æ–±—Ä–∞ —ñ –ª—é–±–æ–≤—ñ.",
    "üéà –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ë–∞–∂–∞—é –∑–¥–æ—Ä–æ–≤'—è, —Ä–∞–¥–æ—Å—Ç—ñ —Ç–∞ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ, —â–æ –≤—Å—ñ —Ç–≤–æ—ó –º—Ä—ñ—ó –∑–¥—ñ–π—Å–Ω—è—Ç—å—Å—è.",
    "üåü {name}, –≤—ñ—Ç–∞—î–º–æ –∑ –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è! –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –¥–µ–Ω—å —Ç–≤–æ–≥–æ –∂–∏—Ç—Ç—è –±—É–¥–µ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω–∏–º —ñ –Ω–∞–ø–æ–≤–Ω–µ–Ω–∏–º —â–∞—Å—Ç—è–º.",
    "üéâ –ó—ñ —Å–≤—è—Ç–æ–º, {name}! –ü–∞–º'—è—Ç–∞–π, —â–æ —Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π/–∞ —ñ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π/–∞ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Å–ø—Ä–∞–≤. –ù–µ—Ö–∞–π –ë–æ–≥ –¥–æ–ø–æ–º–∞–≥–∞—î —Ç–æ–±—ñ –Ω–∞ —Ü—å–æ–º—É —à–ª—è—Ö—É."
    "üéâ –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ù–µ—Ö–∞–π —Ç–≤–æ—î –∂–∏—Ç—Ç—è –±—É–¥–µ –Ω–∞–ø–æ–≤–Ω–µ–Ω–µ —Å–≤—ñ—Ç–ª–æ–º, —â–∞—Å—Ç—è–º —ñ –¥–æ–±—Ä–æ–º!",
    "üåü {name}, –∑—ñ —Å–≤—è—Ç–æ–º! –ù–µ—Ö–∞–π –ì–æ—Å–ø–æ–¥—å –±–ª–∞–≥–æ—Å–ª–æ–≤–ª—è—î —Ç–≤–æ—ó –ø–æ—á–∏–Ω–∞–Ω–Ω—è —Ç–∞ –≤–µ–¥–µ –¥–æ –Ω–∞–π–∫—Ä–∞—â–æ–≥–æ.",
    "üéÇ –í—ñ—Ç–∞—é —Ç–µ–±–µ, {name}! –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å–∏—Ç—å —Ä–∞–¥—ñ—Å—Ç—å, –∞ —Å–µ—Ä—Ü–µ –±—É–¥–µ —Å–ø–æ–∫—ñ–π–Ω–∏–º —ñ —â–∞—Å–ª–∏–≤–∏–º.",
    "üéà –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ù–µ—Ö–∞–π –ª—é–±–æ–≤ —ñ —Ç–µ–ø–ª–æ –∑–∞–≤–∂–¥–∏ –æ—Ç–æ—á—É—é—Ç—å —Ç–µ–±–µ, –∞ –º—Ä—ñ—ó –∑–¥—ñ–π—Å–Ω—é—é—Ç—å—Å—è.",
    "‚ú® {name}, –≤—ñ—Ç–∞—î–º–æ –∑—ñ —Å–≤—è—Ç–æ–º! –ù–µ—Ö–∞–π —Ç–≤–æ—î –∂–∏—Ç—Ç—è –±—É–¥–µ –ø–æ–≤–Ω–∏–º –Ω–æ–≤–∏—Ö –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π —ñ –ë–æ–∂–æ—ó –ø—ñ–¥—Ç—Ä–∏–º–∫–∏.",
    "üéÅ –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ë–∞–∂–∞—é —Ç–æ–±—ñ –±—É—Ç–∏ —Å–º—ñ–ª–∏–≤–∏–º/–æ—é, –¥–æ–±—Ä–∏–º/–æ—é —Ç–∞ –Ω–∞–ø–æ–≤–Ω–µ–Ω–∏–º/–æ—é –ª—é–±–æ–≤‚Äô—é.",
    "ü•≥ {name}, –≤—ñ—Ç–∞—î–º–æ –∑—ñ —Å–≤—è—Ç–æ–º! –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –¥–µ–Ω—å –Ω–∞–≥–∞–¥—É—î —Ç–æ–±—ñ, —â–æ —Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π/–∞ —ñ –≤–∞–∂–ª–∏–≤–∏–π/–∞.",
    "üåü –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ù–µ—Ö–∞–π —Ç–≤–æ—ó –º—Ä—ñ—ó –∑–¥—ñ–π—Å–Ω—é—é—Ç—å—Å—è, –∞ –≤ –¥—É—à—ñ –∑–∞–≤–∂–¥–∏ –±—É–¥–µ —Ä–∞–¥—ñ—Å—Ç—å.",
    "üéâ {name}, –∑—ñ —Å–≤—è—Ç–æ–º! –ë–∞–∂–∞—é —Ç–æ–±—ñ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è, –¥–æ–±—Ä–∏—Ö –¥—Ä—É–∑—ñ–≤ —ñ –ë–æ–∂–æ–≥–æ –ø—Ä–æ–≤–æ–¥—É –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ.",
    "üéÇ –í—ñ—Ç–∞—é —Ç–µ–±–µ, {name}! –ù–µ—Ö–∞–π –∂–∏—Ç—Ç—è –±—É–¥–µ —è—Å–∫—Ä–∞–≤–∏–º, –∞ —Å–µ—Ä—Ü–µ –Ω–∞–ø–æ–≤–Ω–µ–Ω–µ –≤—ñ—Ä–æ—é –≤ —Å–µ–±–µ.",
    "‚ú® –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ù–µ—Ö–∞–π —É —Ç–≤–æ—î–º—É –∂–∏—Ç—Ç—ñ –±—É–¥–µ –±–∞–≥–∞—Ç–æ —Ç–µ–ø–ª–∞, –¥–æ–±—Ä–∏—Ö –ª—é–¥–µ–π —ñ –±–ª–∞–≥–æ—Å–ª–æ–≤—ñ–Ω—å.",
    "üéÅ {name}, –∑ –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è! –ù–µ—Ö–∞–π —Ç–≤–æ—ó —Å—Ç–∞—Ä–∞–Ω–Ω—è –ø—Ä–∏–Ω–æ—Å—è—Ç—å —Ä–∞–¥—ñ—Å—Ç—å, –∞ —Å–µ—Ä—Ü–µ —Å–ø–æ–≤–Ω—é—î—Ç—å—Å—è –≤–¥—è—á–Ω—ñ—Å—Ç—é.",
    "üéà –ó—ñ —Å–≤—è—Ç–æ–º, {name}! –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –¥–µ–Ω—å –Ω–∞–≥–∞–¥—É—î –ø—Ä–æ —Ç–µ, —è–∫ –±–∞–≥–∞—Ç–æ —Ç–∏ –∑–Ω–∞—á–∏—à –¥–ª—è —Ü—å–æ–≥–æ —Å–≤—ñ—Ç—É.",
    "üåü {name}, –≤—ñ—Ç–∞—î–º–æ –∑ –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è! –†–∞–¥–æ—Å—Ç—ñ, –∑–¥–æ—Ä–æ–≤‚Äô—è —ñ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è —Ç–æ–±—ñ –Ω–∞ –∫–æ–∂–µ–Ω –¥–µ–Ω—å!",
    "üéâ –ó –¥–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, {name}! –ù–µ—Ö–∞–π —É —Ç–≤–æ—î–º—É —Å–µ—Ä—Ü—ñ –∑–∞–≤–∂–¥–∏ –±—É–¥–µ –º—ñ—Å—Ü–µ –¥–ª—è –¥–æ–±—Ä–∞ —Ç–∞ —Ä–∞–¥–æ—Å—Ç—ñ!"
]

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —ñ–∑ –±–∞–∑–∏
def load_birthdays():
    with open(DATABASE_PATH, 'r', encoding='utf-8') as file:
        return json.load(file)

# –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–Ω—ñ–≤ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è
async def check_and_send_birthdays():
    today = datetime.now().strftime("%m-%d")
    bot = Bot(token=BOT_TOKEN)
    birthdays = load_birthdays()

    for person in birthdays:
        if person['birth_date'] == today:
            # –í–∏–±—ñ—Ä —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è
            name = f"@{person['username']}" if person['username'] else person['name']
            message = random.choice(greetings).format(name=name)
            # –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è
            await bot.send_message(chat_id=CHAT_ID, text=message)
            print(f"–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –¥–ª—è {name}")

# –ó–∞–ø—É—Å–∫ –∑–∞–≤–¥–∞–Ω–Ω—è
def job():
    asyncio.run(check_and_send_birthdays())

# –ó–∞–ø–ª–∞–Ω—É–π—Ç–µ –∑–∞–ø—É—Å–∫ —â–æ–¥–Ω—è –æ 8:00
schedule.every().day.at("08:00").do(job)

# –ü–æ—Å—Ç—ñ–π–Ω–∞ —Ä–æ–±–æ—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–∏
if __name__ == "__main__":
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω–æ. –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ–≥–æ —á–∞—Å—É...")
    while True:
        schedule.run_pending()
        time.sleep(60)
